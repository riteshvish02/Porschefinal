import"./style.css";import*as THREE from"three";import{OrbitControls}from"three/examples/jsm/controls/OrbitControls.js";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader.js";import{DRACOLoader}from"three/examples/jsm/loaders/DRACOLoader.js";function inet(){gsap.registerPlugin(ScrollTrigger);const e=new LocomotiveScroll({el:document.querySelector("#main"),smooth:!0});e.on("scroll",ScrollTrigger.update),ScrollTrigger.scrollerProxy("#main",{scrollTop(t){return arguments.length?e.scrollTo(t,0,0):e.scroll.instance.scroll.y},getBoundingClientRect:()=>({top:0,left:0,width:window.innerWidth,height:window.innerHeight}),pinType:document.querySelector("#main").style.transform?"transform":"fixed"})}Shery.mouseFollower(),Shery.makeMagnet(".magnet-target",{ease:"cubic-bezier(0.23, 1, 0.320, 1)",duration:1}),inet();const totalItems=12;let loadingBarElement=document.querySelector("#progress"),loadingBarElementh2=document.querySelector("#dib h2");const loadingManager=new THREE.LoadingManager((()=>{window.setTimeout((()=>{console.log("loaded"),gsap.timeline().to("#loading #elem",{clipPath:" polygon(0 0, 0% 0, 0% 100%, 0% 100%)",duration:1.2,ease:"power4.out"},"var").to("#loading",{display:"none",delay:.2},"var2").to("#selector,#nav",{display:"flex",delay:.5},"var2")}),1e3)}),((e,t,o)=>{console.log(t,o);const n=t/12,r=(t/12*100).toFixed();console.log(n,r),loadingBarElement.style.width=`${r}%`,loadingBarElementh2.textContent=r+"%"})),textureLoader=new THREE.TextureLoader(loadingManager),floorterrain=textureLoader.load("/textures/terrain-normal.jpg"),floorrough=textureLoader.load("/textures/terrain-roughness.jpg"),cubetexture=new THREE.CubeTextureLoader(loadingManager),env=cubetexture.load(["/textures/environmentMaps/0/px.jpg","/textures/environmentMaps/0/nx.jpg","/textures/environmentMaps/0/py.jpg","/textures/environmentMaps/0/ny.jpg","/textures/environmentMaps/0/pz.jpg","/textures/environmentMaps/0/nz.jpg"]),dracoLoader=new DRACOLoader(loadingManager);dracoLoader.setDecoderPath("/draco/"),dracoLoader.setDecoderConfig({type:"wasm",url:"/draco/draco_decoder.wasm"});const gltfLoader=new GLTFLoader(loadingManager);gltfLoader.setDRACOLoader(dracoLoader);const canvas=document.querySelector("canvas.webgl"),scene=new THREE.Scene,sizes={width:window.innerWidth,height:window.innerHeight},camera=new THREE.PerspectiveCamera(75,sizes.width/sizes.height);camera.position.z=70,scene.add(camera);const renderer=new THREE.WebGLRenderer({canvas,antialias:!0});renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),renderer.physicallyCorrectLights=!0,renderer.outputEncoding=THREE.sRGBEncoding,renderer.shadowMap.enabled=!0,renderer.toneMappingExposure=3,renderer.setClearColor("#111");const fog=new THREE.Fog("#111",50,130);scene.fog=fog;const directionlight=new THREE.DirectionalLight("#ffffff",15);directionlight.position.set(-5.763,90,-2.25),scene.add(directionlight),directionlight.castShadow=!0,directionlight.shadow.mapSize.width=2048,directionlight.shadow.mapSize.height=2048,directionlight.shadow.camera.left=-50,directionlight.shadow.camera.right=50,directionlight.shadow.camera.top=50,directionlight.shadow.camera.bottom=-50,directionlight.shadow.camera.near=.5,directionlight.shadow.camera.far=500;const DirectionalLightHelper=new THREE.DirectionalLightHelper(directionlight,.2),ambientLight=new THREE.AmbientLight("#b9d5ff",.12);scene.add(ambientLight);const floor=new THREE.Mesh(new THREE.PlaneGeometry(400,400),new THREE.MeshStandardMaterial({color:"#111",normalMap:floorterrain,roughnessMap:floorrough,roughness:.8,metalness:1}));let model;floor.geometry.setAttribute("uv2",new THREE.Float32BufferAttribute(floor.geometry.attributes.uv.array,2)),floorrough.repeat.set(2,2),floorterrain.repeat.set(5,5),floor.receiveShadow=!0,floorterrain.wrapS=THREE.RepeatWrapping,floorrough.wrapT=THREE.RepeatWrapping,floor.rotation.x=.5*-Math.PI,floor.position.y=-12.5,scene.add(floor);let carPaintMesh=null,tyreMeshes=[];function adjustModelForScreen(){model&&(window.matchMedia("(max-width: 768px)").matches?(model.scale.set(13,13,13),model.position.set(0,-4,0)):model.scale.set(25,25,25))}gltfLoader.load("/models/scene.glb",(e=>{model=e.scene,model.scale.set(25,25,25),model.position.set(0,0,0),model.rotation.y=Math.PI/2,scene.add(model),adjustModelForScreen(),model&&gsap.timeline().to("#navcenter img:nth-child(1),#navcenter img:nth-child(7)",{transform:"translateY(0)",duration:1,ease:"power1.out"},"var2").to("#navcenter img:nth-child(2),#navcenter img:nth-child(6)",{transform:"translateY(0)",delay:.2,duration:1,ease:"power1.out"},"var2").to("#navcenter img:nth-child(3),#navcenter img:nth-child(5)",{transform:"translateY(0)",delay:.3,duration:1,ease:"power1.out"},"var2").to("#navcenter img:nth-child(4)",{transform:"translateY(0)",delay:.4,duration:1,ease:"power1.out"},"var2"),updateMaterial()}));let wasMobile=sizes.width<=768;function refreshPageIfNeeded(){const e=window.innerWidth<=768;e!==wasMobile&&location.reload(),wasMobile=e}function updateMaterial(){scene.traverse((e=>{e instanceof THREE.Mesh&&e.material instanceof THREE.MeshStandardMaterial&&(e.material.envMap=env,e.castShadow=!0,e.receiveShadow=!0),e.isMesh&&"EXT_Carpaint.004"===e.material.name&&(carPaintMesh=e,carPaintMesh.material.color.set("white"))}))}refreshPageIfNeeded();const controls=new OrbitControls(camera,canvas);function changeCarPaintColor(e){carPaintMesh&&carPaintMesh.material.color.set(e)}controls.minPolarAngle=Math.PI/2.6,controls.maxPolarAngle=Math.PI/2.6,controls.enableZoom=!1,controls.dampingFactor=.25,controls.enableDamping=!0;const clock=new THREE.Clock;function animate(){controls.update();const e=clock.getElapsedTime();model&&(floor.rotation.z=.2*e,model.rotation.y=.2*e),renderer.render(scene,camera),requestAnimationFrame(animate)}animate(),window.addEventListener("resize",(()=>{sizes.width=window.innerWidth,sizes.height=window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),refreshPageIfNeeded(),adjustModelForScreen()}));const colors=["#FFCC00","#CC0033","black","#A4C4B8","#00194B","#333333","red"];let currentColorIndex=0;function autoChangeColor(){carPaintMesh&&(currentColorIndex=(currentColorIndex+1)%colors.length,carPaintMesh.material.color.set(colors[currentColorIndex]))}setInterval(autoChangeColor,1e4),document.querySelectorAll("button[data-color]").forEach((e=>{e.addEventListener("click",(()=>{changeCarPaintColor(e.getAttribute("data-color")),clearInterval(autoChangeColor)}))}));const tl=gsap.timeline({paused:!0,reversed:!0}),openNav=()=>{animateOpenNav();const e=document.getElementById("menu-toggle-btn");e.onclick=function(t){e.classList.toggle("active"),tl.reversed()?tl.play():tl.reverse()}},animateOpenNav=()=>{tl.to(".nav-container",{duration:.1,autoAlpha:1}).from(".contact svg",{duration:.2,y:30,opacity:0,delay:.7,color:"#fff",ease:"expo.out",stagger:{amount:.1}}).from(".flex > div",{duration:.4,opacity:0,y:10,stagger:{amount:.04}}).to(".nav-link > a",{duration:.8,top:0,ease:"power2.inOut",stagger:{amount:.1}},"-=0.4").from(".btn button",{duration:.5,y:30,opacity:0,ease:"power2.inOut",stagger:{amount:.1},color:"#fff"},"-=0.1").from(".nav-footer",{duration:.3,opacity:0},"-=0.5")},leftBox1=document.getElementById("infoone"),leftBox2=document.getElementById("infothree"),rightBox1=document.getElementById("infotwo"),rightBox2=document.getElementById("infofour"),leftBox3=document.getElementById("infofive"),leftButton1=document.getElementById("select3"),leftButton2=document.getElementById("select2"),rightButton1=document.getElementById("select1"),rightButton2=document.getElementById("select4"),leftButton3=document.getElementById("select5");let left1Toggled=!1,left2Toggled=!1,right1Toggled=!1,right2Toggled=!1,left3Toggled=!1;function closeAllDivs(){gsap.to(leftBox1,{transform:"translateX(-100%)",duration:1,ease:"expo.out"}),gsap.to(leftBox2,{transform:"translateX(-100%)",duration:1,ease:"expo.out"}),gsap.to(rightBox1,{transform:"translateX(100%)",duration:1,ease:"expo.out"}),gsap.to(rightBox2,{transform:"translateX(100%)",duration:1,ease:"expo.out"}),gsap.to(leftBox3,{transform:"translateX(-100%)",duration:1,ease:"expo.out"}),left1Toggled=!1,left2Toggled=!1,right1Toggled=!1,right2Toggled=!1,left3Toggled=!1}function toggleBox(e,t,o,n){gsap.to(e,{transform:t?"translateX(0%)":`translateX(${o})`,duration:1,ease:"expo.out"}),t&&setTimeout((()=>{gsap.to(e,{transform:`translateX(${o})`,duration:1,ease:"expo.out"}),n(!1)}),1e4)}function aniInit(){new SplitType(".item h1",{types:"chars"}),document.querySelectorAll(".marquee-container").forEach(((e,t)=>{let o="0%",n="-15%";t%2==0&&(o="0%",n="10%");const r=e.querySelector(".marquee"),a=r.querySelectorAll(".item h1");gsap.fromTo(r,{x:o},{x:n,scrollTrigger:{trigger:e,start:"top bottom",end:"150% top",scrub:!0,scroller:"#main"}}),a.forEach((e=>{const o=Array.from(e.querySelectorAll(".char"));o.length&&((e,t=!1)=>{const o={each:.35,from:t?"start":"end",ease:"linear"};gsap.fromTo(e,{fontWeight:100},{fontWeight:"bolder",duration:1,ease:"none",stagger:o,scrollTrigger:{trigger:e[0].closest(".marquee-container"),start:"50% bottom",end:"top top",scrub:!0,scroller:"#main"}})})(o,t%2!=0)}))}))}function page2(){document.addEventListener("DOMContentLoaded",(()=>{aniInit()}))}function canva(){const e=document.querySelector("#page5>canvas"),t=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",(function(){e.width=window.innerWidth,e.height=window.innerHeight,r()}));const o=[],n={frame:0};for(let e=1;e<=100;e++){const t=new Image;t.src=`/finalcanva//scene${String(e).padStart(5,"0")}.png`,t.onload=()=>{console.log(`Image ${e} loaded successfully.`)},t.onerror=()=>{console.error(`Image ${e} failed to load.`)},o.push(t)}function r(){o[n.frame].complete&&0!==o[n.frame].naturalWidth?function(e,t){const o=t.canvas,n=o.width/e.width,r=o.height/e.height,a=Math.max(n,r),i=(o.width-e.width*a)/2,l=(o.height-e.height*a)/2;t.clearRect(0,0,o.width,o.height),t.drawImage(e,0,0,e.width,e.height,i,l,e.width*a,e.height*a)}(o[n.frame],t):console.error(`Image ${n.frame+1} is broken or not loaded yet.`)}o[0].onload=()=>{gsap.timeline({scrollTrigger:{trigger:"#page5",start:"top top",pin:!0,scroller:"#main",scrub:3,end:"500% 0%"}}).to(n,{frame:99,snap:"frame",ease:"none",duration:30,onUpdate:r}),r()}}function page1(){var e=gsap.timeline({scrollTrigger:{scroller:"#main",trigger:"#page1",start:"top -1%",end:"700% top",pin:!0,scrub:2}});e.to(".right-inner",{transform:"translateY(-110%)",duration:50,delay:1},"a"),e.to(".left-inner",{transform:"translateY(-105.5%)",duration:50,delay:1},"a")}leftButton1.addEventListener("click",(()=>{const e=left1Toggled;closeAllDivs(),left1Toggled=!e,toggleBox(leftBox1,left1Toggled,"-100%",(e=>left1Toggled=e))})),leftButton2.addEventListener("click",(()=>{const e=left2Toggled;closeAllDivs(),left2Toggled=!e,toggleBox(leftBox2,left2Toggled,"-100%",(e=>left2Toggled=e))})),rightButton1.addEventListener("click",(()=>{const e=right1Toggled;closeAllDivs(),right1Toggled=!e,toggleBox(rightBox1,right1Toggled,"100%",(e=>right1Toggled=e))})),rightButton2.addEventListener("click",(()=>{const e=right2Toggled;closeAllDivs(),right2Toggled=!e,toggleBox(rightBox2,right2Toggled,"100%",(e=>right2Toggled=e))})),leftButton3.addEventListener("click",(()=>{const e=left3Toggled;closeAllDivs(),left3Toggled=!e,toggleBox(leftBox3,left3Toggled,"-100%",(e=>left3Toggled=e))})),page2(),document.querySelectorAll("#page3 #left #child").forEach((e=>{e.addEventListener("mouseenter",(t=>{const o=document.querySelector("#page3 #right #clip"),n=e.getAttribute("data-image"),r=document.querySelector(`#page3 #right #clip #${n}`);if(r.classList.contains("active"))return r.style.transition="none",r.style.transform="scale(0)",r.style.opacity="0",void requestAnimationFrame((()=>{requestAnimationFrame((()=>{r.style.transition="transform 0.5s ease, opacity 0.5s ease",r.style.transform="scale(1)",r.style.opacity="1"}))}));r.classList.add("active"),document.querySelectorAll("#page3 #right #clip img.active:not(#"+n+")").forEach((e=>{e.style.zIndex="0",e.classList.remove("active")})),e.getBoundingClientRect();const a=o.getBoundingClientRect(),i=document.querySelector("#page3 #right").getBoundingClientRect(),l=e=>{const t=e.clientY-i.top,n=a.height,r=Math.min(Math.max(t-n/2,0),i.height-n);o.style.position="absolute",o.style.top=`${r}px`};r.style.transition="none",r.style.transform="scale(0)",r.style.opacity="0",r.style.zIndex="1",requestAnimationFrame((()=>{requestAnimationFrame((()=>{r.style.transition="transform 0.5s ease, opacity 0.5s ease",r.style.transform="scale(1)",r.style.opacity="1"}))})),document.addEventListener("mousemove",l),e.addEventListener("mouseleave",(()=>{document.removeEventListener("mousemove",l)}))}))}));const isMobile=window.innerWidth<=768;isMobile||(page1(),canva());const openBtn=document.querySelector(".open-btn"),closeBtn=document.querySelector(".close-btn"),menuOverlay2=document.querySelector(".menu-overlay2"),menuOverlay=document.querySelector(".menu-overlay"),menu=document.querySelector(".menu"),openTl=gsap.timeline({paused:!0});openTl.to(menuOverlay,{left:"0vw",duration:.3,ease:"power2.out"},"a").to(menuOverlay2,{left:"0vw",duration:.3,ease:"power2.out",delay:.2},"a");const closeTl=gsap.timeline({paused:!0});async function fetchContent(e){return new Promise((t=>{let o="";"models"===e?o='\n                <img src="https://nav.porsche.com/00BC524/series-assets/1360/718.webp" alt="Model 1">\n                <img src="https://nav.porsche.com/00BC524/series-assets/1360/911.webp" alt="Model 2">\n                <img src="https://nav.porsche.com/00BC524/series-assets/1360/taycan.webp" alt="Model 3">\n                <img src="https://nav.porsche.com/00BC524/series-assets/1360/panamera.webp" alt="Model 4">\n                <img src="https://nav.porsche.com/00BC524/series-assets/1360/macan.webp" alt="Model 5">\n            ':"vehicle-purchase"===e?o='\n                <h4 style="margin-top:-18vw; width:6vw;">Configure</h4>\n                <h4 style="width:10vw;">Compare Models</h4>\n                <h4 style="width:18.9vw;">Find New and Pre-owned Vehicles</h4>\n                <h4 style="width:16vw;">E-Mobility & E-Performance</h4>\n            ':"services"===e?o='\n                <h4 style="margin-top:-12vw; width:9.7vw;">Factory Delivery</h4>\n                <h4 style="width:20.5vw;">Tequipment - Genuine Accessories</h4>\n                <h4 style="width:23.5vw;">Exclusive Manufaktur - Individual Vehicles</h4>\n                <h4 style="width:23vw;">Approved - Pre-owned Cars & Warranty</h4>\n                <h4 style="width:13vw;">Service & Maintenance</h4>\n                <h4 style="width:13.7vw;">Classic - Service & Parts</h4>\n                <h4 style="width:18.7vw;">Lifestyle - Fashion & Accessories</h4>\n            ':"dealers"===e?o='\n                <h4 style="margin-top:-14vw; width:7.2vw;">Ahemdabad</h4>\n                <h4 style="width:6vw;">Banglore</h4>\n                <h4 style="width:7.2vw;">Chandigarh</h4>\n                <h4 style="width:5.7vw;">Chennai</h4>\n                <h4 style="width:5.2vw;">Gurgaon</h4>\n                <h4 style="width:6vw;">New Delhi</h4>\n                <h4 style="width:5vw;">Mumbai</h4>\n            ':"experience"===e&&(o='\n                <h4 style="margin-top:-15vw; width:7vw">Motorsport</h4>\n                <h4 style="width:18vw;">Porsche Experience – Driving & Track Experiences</h4>\n                <h4 style="width:8vw;">Porsche clubs</h4>\n                <h4 style="width:2.7vw;">Golf</h4>\n                <h4 style="width:18vw;">Christophorus – The Porsche Magazine</h4>\n                <h4 style="width:10vw;">Porsche Museum</h4>\n            '),t(o)}))}async function showContent(e){const t=document.querySelector(".menu-con-2"),o=t.querySelector(".content"),n=await fetchContent(e);if(o){o.classList.add("exiting"),o.addEventListener("transitionend",(()=>{o.remove()}),{once:!0});const e=document.createElement("div");e.classList.add("content"),e.innerHTML=n,t.appendChild(e),requestAnimationFrame((()=>{e.classList.add("active")}))}else{const e=document.createElement("div");e.classList.add("content"),e.innerHTML=n,t.appendChild(e),requestAnimationFrame((()=>{e.classList.add("active")}))}}function rollingtext(){let e=document.querySelectorAll(".rolling-text");e.forEach((e=>{let t=e.innerText;e.innerHTML="";let o=document.createElement("div");o.classList.add("block");for(let e of t){let t=document.createElement("span");t.innerText=""===e.trim()?" ":e,t.classList.add("letter"),o.appendChild(t)}e.appendChild(o),e.appendChild(o.cloneNode(!0))})),e.forEach((e=>{e.addEventListener("mouseover",(()=>{e.classList.remove("play")}))}))}closeTl.to(menuOverlay2,{left:"-100vw",duration:.3,ease:"power2.in"},"b").to(menuOverlay,{left:"-100vw",duration:.3,ease:"power2.in",delay:.2},"b"),openBtn.addEventListener("click",(()=>{openTl.restart()})),closeBtn.addEventListener("click",(()=>{closeTl.restart()})),document.querySelectorAll(".menu-con-1 h3").forEach((e=>{e.addEventListener("click",(async()=>{const t=e.getAttribute("data-target");await showContent(t),document.querySelectorAll(".menu-con-1 h3").forEach((e=>e.classList.remove("active"))),e.classList.add("active")}))})),document.addEventListener("DOMContentLoaded",(()=>{showContent("models"),document.querySelector('.menu-con-1 h3[data-target="models"]').classList.add("active")})),rollingtext();