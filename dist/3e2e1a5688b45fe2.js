import"./style.css";import*as THREE from"three";import{OrbitControls}from"three/examples/jsm/controls/OrbitControls.js";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader.js";import{DRACOLoader}from"three/examples/jsm/loaders/DRACOLoader.js";function inet(){gsap.registerPlugin(ScrollTrigger);const e=new LocomotiveScroll({el:document.querySelector("#main"),smooth:!0});e.on("scroll",ScrollTrigger.update),ScrollTrigger.scrollerProxy("#main",{scrollTop(t){return arguments.length?e.scrollTo(t,0,0):e.scroll.instance.scroll.y},getBoundingClientRect:()=>({top:0,left:0,width:window.innerWidth,height:window.innerHeight}),pinType:document.querySelector("#main").style.transform?"transform":"fixed"})}Shery.mouseFollower(),inet();const loadingManager=new THREE.LoadingManager((()=>{window.setTimeout((()=>{console.log("loaded"),gsap.timeline().to("#loading #elem",{clipPath:" polygon(0 0, 0% 0, 0% 100%, 0% 100%)",duration:1.2,ease:"power4.out"},"var").to("#loading",{display:"none",delay:.2},"var")}),1e3)}),((e,t,o)=>{})),textureLoader=new THREE.TextureLoader(loadingManager),floorterrain=textureLoader.load("/textures/terrain-normal.jpg"),floorrough=textureLoader.load("/textures/terrain-roughness.jpg"),cubetexture=new THREE.CubeTextureLoader(loadingManager),env=cubetexture.load(["/textures/environmentMaps/1/px.jpg","/textures/environmentMaps/1/nx.jpg","/textures/environmentMaps/1/py.jpg","/textures/environmentMaps/1/ny.jpg","/textures/environmentMaps/1/pz.jpg","/textures/environmentMaps/1/nz.jpg"]),dracoLoader=new DRACOLoader(loadingManager);dracoLoader.setDecoderPath("/draco/"),dracoLoader.setDecoderConfig({type:"wasm",url:"/draco/draco_decoder.wasm"});const gltfLoader=new GLTFLoader(loadingManager);gltfLoader.setDRACOLoader(dracoLoader);const canvas=document.querySelector("canvas.webgl"),scene=new THREE.Scene,sizes={width:window.innerWidth,height:window.innerHeight},camera=new THREE.PerspectiveCamera(75,sizes.width/sizes.height);camera.position.z=70,scene.add(camera);const renderer=new THREE.WebGLRenderer({canvas,antialias:!0});renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),renderer.physicallyCorrectLights=!0,renderer.outputEncoding=THREE.sRGBEncoding,env.encoding=THREE.sRGBEncoding,renderer.shadowMap.enabled=!0,renderer.toneMappingExposure=2,renderer.setClearColor("#111");const fog=new THREE.Fog("#111",50,130);scene.fog=fog;const directionlight=new THREE.DirectionalLight("#ffffff",15);directionlight.position.set(-5.763,40,-2.25),scene.add(directionlight),directionlight.castShadow=!0,directionlight.shadow.mapSize.width=2048,directionlight.shadow.mapSize.height=2048,directionlight.shadow.camera.left=-50,directionlight.shadow.camera.right=50,directionlight.shadow.camera.top=50,directionlight.shadow.camera.bottom=-50,directionlight.shadow.camera.near=.5,directionlight.shadow.camera.far=500;const DirectionalLightHelper=new THREE.DirectionalLightHelper(directionlight,.2),ambientLight=new THREE.AmbientLight("#b9d5ff",.12);scene.add(ambientLight);const floor=new THREE.Mesh(new THREE.PlaneGeometry(400,400),new THREE.MeshStandardMaterial({color:"#111",normalMap:floorterrain,roughnessMap:floorrough,roughness:.8,metalness:1}));let model;floor.geometry.setAttribute("uv2",new THREE.Float32BufferAttribute(floor.geometry.attributes.uv.array,2)),floorrough.repeat.set(2,2),floorterrain.repeat.set(5,5),floor.receiveShadow=!0,floorterrain.wrapS=THREE.RepeatWrapping,floorrough.wrapT=THREE.RepeatWrapping,floor.rotation.x=.5*-Math.PI,floor.position.y=-12.5,scene.add(floor);let carPaintMesh=null,tyreMeshes=[];function adjustModelForScreen(){model&&(window.matchMedia("(max-width: 768px)").matches?(model.scale.set(13,13,13),model.position.set(0,-4,0)):model.scale.set(25,25,25))}gltfLoader.load("/models/scene.glb",(e=>{model=e.scene,model.scale.set(25,25,25),model.position.set(0,0,0),model.rotation.y=Math.PI/2,scene.add(model),adjustModelForScreen(),updateMaterial()}));let wasMobile=sizes.width<=768;function refreshPageIfNeeded(){const e=window.innerWidth<=768;e!==wasMobile&&location.reload(),wasMobile=e}function updateMaterial(){scene.traverse((e=>{e instanceof THREE.Mesh&&e.material instanceof THREE.MeshStandardMaterial&&(e.material.envMap=env,e.castShadow=!0,e.receiveShadow=!0),e.isMesh&&"EXT_Carpaint.004"===e.material.name&&(carPaintMesh=e,carPaintMesh.material.color.set("white"))}))}refreshPageIfNeeded();const controls=new OrbitControls(camera,canvas);function changeCarPaintColor(e){carPaintMesh&&carPaintMesh.material.color.set(e)}controls.minPolarAngle=Math.PI/2.6,controls.maxPolarAngle=Math.PI/2.6,controls.enableZoom=!1,controls.dampingFactor=.25,controls.enableDamping=!0;const clock=new THREE.Clock;function animate(){controls.update();const e=clock.getElapsedTime();model&&(floor.rotation.z=.2*e,model.rotation.y=.2*e),renderer.render(scene,camera),requestAnimationFrame(animate)}animate(),window.addEventListener("resize",(()=>{sizes.width=window.innerWidth,sizes.height=window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),refreshPageIfNeeded(),adjustModelForScreen()})),document.querySelectorAll("button[data-color]").forEach((e=>{e.addEventListener("click",(()=>{changeCarPaintColor(e.getAttribute("data-color"))}))}));const tl=gsap.timeline({paused:!0,reversed:!0}),openNav=()=>{animateOpenNav();const e=document.getElementById("menu-toggle-btn");e.onclick=function(t){e.classList.toggle("active"),tl.reversed()?tl.play():tl.reverse()}},animateOpenNav=()=>{tl.to(".nav-container",{duration:.1,autoAlpha:1}).from(".contact svg",{duration:.2,y:30,opacity:0,delay:.7,color:"#fff",ease:"expo.out",stagger:{amount:.1}}).from(".flex > div",{duration:.4,opacity:0,y:10,stagger:{amount:.04}}).to(".nav-link > a",{duration:.8,top:0,ease:"power2.inOut",stagger:{amount:.1}},"-=0.4").from(".btn button",{duration:.5,y:30,opacity:0,ease:"power2.inOut",stagger:{amount:.1},color:"#fff"},"-=0.1").from(".nav-footer",{duration:.3,opacity:0},"-=0.5")},leftBox1=document.getElementById("infoone"),leftBox2=document.getElementById("infothree"),rightBox1=document.getElementById("infotwo"),rightBox2=document.getElementById("infofour"),leftButton1=document.getElementById("select3"),leftButton2=document.getElementById("select2"),rightButton1=document.getElementById("select1"),rightButton2=document.getElementById("select4");let left1Toggled=!1,left2Toggled=!1,right1Toggled=!1,right2Toggled=!1;function closeAllDivs(){gsap.to(leftBox1,{transform:"translateX(-100%)",duration:1,ease:"expo.out"}),gsap.to(leftBox2,{transform:"translateX(-100%)",duration:1,ease:"expo.out"}),gsap.to(rightBox1,{transform:"translateX(100%)",duration:1,ease:"expo.out"}),gsap.to(rightBox2,{transform:"translateX(100%)",duration:1,ease:"expo.out"}),left1Toggled=!1,left2Toggled=!1,right1Toggled=!1,right2Toggled=!1}function toggleBox(e,t,o,r){gsap.to(e,{transform:t?"translateX(0%)":`translateX(${o})`,duration:1,ease:"expo.out"}),t&&setTimeout((()=>{gsap.to(e,{transform:`translateX(${o})`,duration:1,ease:"expo.out"}),r(!1)}),1e4)}function aniInit(){new SplitType(".item h1",{types:"chars"}),document.querySelectorAll(".marquee-container").forEach(((e,t)=>{let o="0%",r="-15%";t%2==0&&(o="0%",r="10%");const n=e.querySelector(".marquee"),a=n.querySelectorAll(".item h1");gsap.fromTo(n,{x:o},{x:r,scrollTrigger:{trigger:e,start:"top bottom",end:"150% top",scrub:!0,scroller:"#main"}}),a.forEach((e=>{const o=Array.from(e.querySelectorAll(".char"));o.length&&((e,t=!1)=>{const o={each:.35,from:t?"start":"end",ease:"linear"};gsap.fromTo(e,{fontWeight:100},{fontWeight:"bolder",duration:1,ease:"none",stagger:o,scrollTrigger:{trigger:e[0].closest(".marquee-container"),start:"50% bottom",end:"top top",scrub:!0,scroller:"#main"}})})(o,t%2!=0)}))}))}function page2(){document.addEventListener("DOMContentLoaded",(()=>{aniInit()}))}leftButton1.addEventListener("click",(()=>{const e=left1Toggled;closeAllDivs(),left1Toggled=!e,toggleBox(leftBox1,left1Toggled,"-100%",(e=>left1Toggled=e))})),leftButton2.addEventListener("click",(()=>{const e=left2Toggled;closeAllDivs(),left2Toggled=!e,toggleBox(leftBox2,left2Toggled,"-100%",(e=>left2Toggled=e))})),rightButton1.addEventListener("click",(()=>{const e=right1Toggled;closeAllDivs(),right1Toggled=!e,toggleBox(rightBox1,right1Toggled,"100%",(e=>right1Toggled=e))})),rightButton2.addEventListener("click",(()=>{const e=right2Toggled;closeAllDivs(),right2Toggled=!e,toggleBox(rightBox2,right2Toggled,"100%",(e=>right2Toggled=e))})),page2();